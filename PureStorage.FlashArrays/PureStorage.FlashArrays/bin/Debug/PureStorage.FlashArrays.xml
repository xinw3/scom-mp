<?xml version="1.0" encoding="utf-8"?>
<ManagementPack SchemaVersion="2.0" ContentReadable="true" xmlns:xsd="http://www.w3.org/2001/XMLSchema">
  <Manifest>
    <Identity>
      <ID>PureStorage.FlashArrays</ID>
      <Version>1.0.0.132</Version>
    </Identity>
    <Name>PureStorage.FlashArrays</Name>
    <References>
      <Reference Alias="InstanceGroup">
        <ID>Microsoft.SystemCenter.InstanceGroup.Library</ID>
        <Version>7.5.8501.0</Version>
        <PublicKeyToken>31bf3856ad364e35</PublicKeyToken>
      </Reference>
      <Reference Alias="SC">
        <ID>Microsoft.SystemCenter.Library</ID>
        <Version>7.0.8433.0</Version>
        <PublicKeyToken>31bf3856ad364e35</PublicKeyToken>
      </Reference>
      <Reference Alias="Windows">
        <ID>Microsoft.Windows.Library</ID>
        <Version>7.5.8501.0</Version>
        <PublicKeyToken>31bf3856ad364e35</PublicKeyToken>
      </Reference>
      <Reference Alias="Health">
        <ID>System.Health.Library</ID>
        <Version>7.0.8433.0</Version>
        <PublicKeyToken>31bf3856ad364e35</PublicKeyToken>
      </Reference>
      <Reference Alias="System">
        <ID>System.Library</ID>
        <Version>7.5.8501.0</Version>
        <PublicKeyToken>31bf3856ad364e35</PublicKeyToken>
      </Reference>
    </References>
  </Manifest>
  <TypeDefinitions>
    <EntityTypes>
      <ClassTypes>
        <ClassType ID="Pure.FlashArrays.ComputerRole.ArraysBase" Base="Windows!Microsoft.Windows.ComputerRole" Accessibility="Public" Abstract="true" Hosted="true" Singleton="false">
          <Property ID="Version" Key="false" Type="string" />
        </ClassType>
        <ClassType ID="Pure.FlashArrays.Arrays" Base="Pure.FlashArrays.ComputerRole.ArraysBase" Accessibility="Public" Abstract="false" Hosted="true" Singleton="false">
          <Property ID="Controllers" Key="false" Type="string" />
          <Property ID="Hosts" Key="false" Type="string" />
          <Property ID="Volumes" Key="false" Type="string" />
        </ClassType>
        <ClassType ID="Pure.FlashArrays.ArraysComponents" Base="Windows!Microsoft.Windows.ApplicationComponent" Accessibility="Public" Abstract="false" Hosted="true" Singleton="false">
          <Property ID="Controllers" Key="false" Type="string" />
          <Property ID="Hosts" Key="false" Type="string" />
          <Property ID="Volumes" Key="false" Type="string" />
        </ClassType>
        <ClassType ID="Pure.FlashArrays.InstanceGroups" Accessibility="Public" Base="InstanceGroup!Microsoft.SystemCenter.InstanceGroup" Abstract="false" Hosted="false" Singleton="true" />
        <ClassType ID="Pure.FlashArrays.ComputerGroups" Accessibility="Public" Base="SC!Microsoft.SystemCenter.ComputerGroup" Abstract="false" Hosted="false" Singleton="true" />
        <ClassType ID="Pure.FlashArrays.HealthRollup" Accessibility="Public" Base="System!System.ComputerRole" Abstract="false" Hosted="false" Singleton="true" />
      </ClassTypes>
      <RelationshipTypes>
        <RelationshipType ID="Pure.FlashArrays.ArraysHostComponents" Base="System!System.Hosting" Accessibility="Public" Abstract="false">
          <Source ID="Source" Type="Pure.FlashArrays.Arrays" />
          <Target ID="Target" Type="Pure.FlashArrays.ArraysComponents" />
        </RelationshipType>
        <RelationshipType ID="Pure.FlashArrays.HealthRollupContainsArrays" Base="System!System.Containment" Abstract="false" Accessibility="Public">
          <Source ID="Source" Type="Pure.FlashArrays.HealthRollup" />
          <Target ID="Target" Type="Pure.FlashArrays.Arrays" />
        </RelationshipType>
      </RelationshipTypes>
    </EntityTypes>
    <ModuleTypes>
      <DataSourceModuleType ID="Pure.FlashArrays.DataSource.AccessArrays" Accessibility="Internal">
        <Configuration>
          <xsd:element name="SyncTime" minOccurs="0" type="xsd:string" xmlns:xsd="http://www.w3.org/2001/XMLSchema" />
          <xsd:element name="IntervalSeconds" type="xsd:integer" xmlns:xsd="http://www.w3.org/2001/XMLSchema" />
          <xsd:element name="TimeoutSeconds" type="xsd:integer" xmlns:xsd="http://www.w3.org/2001/XMLSchema" />
        </Configuration>
        <OverrideableParameters>
          <OverrideableParameter ID="IntervalSeconds" Selector="$Config/IntervalSeconds$" ParameterType="int" />
          <OverrideableParameter ID="TimeoutSeconds" Selector="$Config/TimeoutSeconds$" ParameterType="int" />
        </OverrideableParameters>
        <ModuleImplementation>
          <Composite>
            <MemberModules>
              <DataSource ID="Schedule" TypeID="System!System.SimpleScheduler">
                <IntervalSeconds>$Config/IntervalSeconds$</IntervalSeconds>
                <SyncTime>$Config/SyncTime$</SyncTime>
              </DataSource>
              <ProbeAction ID="Probe" TypeID="Pure.FlashArrays.Probe.AccessArrays">
                <ComputerName>scom-xin</ComputerName>
              </ProbeAction>
            </MemberModules>
            <Composition>
              <Node ID="Probe">
                <Node ID="Schedule" />
              </Node>
            </Composition>
          </Composite>
        </ModuleImplementation>
        <OutputType>System!System.PropertyBagData</OutputType>
      </DataSourceModuleType>
      <ProbeActionModuleType ID="Pure.FlashArrays.Probe.AccessArrays" Accessibility="Internal">
        <Configuration>
          <xsd:element name="ComputerName" type="xsd:string" xmlns:xsd="http://www.w3.org/2001/XMLSchema" />
        </Configuration>
        <ModuleImplementation>
          <Composite>
            <MemberModules>
              <ProbeAction ID="Script" TypeID="Windows!Microsoft.Windows.PowerShellPropertyBagTriggerOnlyProbe">
                <ScriptName>MonitorArrays.ps1</ScriptName>
                <ScriptBody>$IncludeFileContent/Health Model/MonitorArrays.ps1</ScriptBody>
                <TimeoutSeconds>120</TimeoutSeconds>
              </ProbeAction>
            </MemberModules>
            <Composition>
              <Node ID="Script" />
            </Composition>
          </Composite>
        </ModuleImplementation>
        <OutputType>System!System.PropertyBagData</OutputType>
        <TriggerOnly>true</TriggerOnly>
      </ProbeActionModuleType>
    </ModuleTypes>
    <MonitorTypes>
      <UnitMonitorType ID="Pure.FlashArrays.Monitor.AccessArrays" Accessibility="Internal">
        <MonitorTypeStates>
          <MonitorTypeState ID="Success" NoDetection="false" />
          <MonitorTypeState ID="Failure" NoDetection="false" />
        </MonitorTypeStates>
        <Configuration>
          <xsd:element name="IntervalSeconds" type="xsd:integer" xmlns:xsd="http://www.w3.org/2001/XMLSchema" />
          <xsd:element name="SyncTime" type="xsd:string" xmlns:xsd="http://www.w3.org/2001/XMLSchema" />
          <xsd:element name="TimeoutSeconds" type="xsd:string" xmlns:xsd="http://www.w3.org/2001/XMLSchema" />
        </Configuration>
        <OverrideableParameters>
          <OverrideableParameter ID="IntervalSeconds" Selector="$Config/IntervalSeconds$" ParameterType="int" />
          <OverrideableParameter ID="SyncTime" Selector="$Config/SyncTime$" ParameterType="string" />
        </OverrideableParameters>
        <MonitorImplementation>
          <MemberModules>
            <DataSource ID="DS.Monitor" TypeID="Pure.FlashArrays.DataSource.AccessArrays">
              <IntervalSeconds>$Config/IntervalSeconds$</IntervalSeconds>
              <TimeoutSeconds>100</TimeoutSeconds>
            </DataSource>
            <ProbeAction ID="Monitor.PassThru" TypeID="System!System.PassThroughProbe" />
            <ProbeAction ID="Probe" TypeID="Pure.FlashArrays.Probe.AccessArrays">
              <ComputerName>scom-xin</ComputerName>
            </ProbeAction>
          </MemberModules>
          <RegularDetections>
            <RegularDetection MonitorTypeStateID="Success">
              <Node ID="Probe">
                <Node ID="Monitor.PassThru" />
              </Node>
            </RegularDetection>
            <RegularDetection MonitorTypeStateID="Failure">
              <Node ID="Probe">
                <Node ID="Monitor.PassThru" />
              </Node>
            </RegularDetection>
          </RegularDetections>
        </MonitorImplementation>
      </UnitMonitorType>
    </MonitorTypes>
  </TypeDefinitions>
  <Monitoring>
    <Discoveries>
      <Discovery ID="PureStorage.FlashArrays.Discovery.Controllers.PowerShell" Target="Pure.FlashArrays.Arrays" Enabled="true" ConfirmDelivery="false" Remotable="true" Priority="Normal">
        <Category>Discovery</Category>
        <DiscoveryTypes>
          <DiscoveryClass TypeID="Pure.FlashArrays.Arrays" />
          <DiscoveryRelationship TypeID="Windows!Microsoft.Windows.ComputerHostsLocalApplication" />
        </DiscoveryTypes>
        <DataSource ID="DS" TypeID="Windows!Microsoft.Windows.TimedPowerShell.DiscoveryProvider">
          <IntervalSeconds>600</IntervalSeconds>
          <SyncTime />
          <ScriptName>Demo.ps1</ScriptName>
          <ScriptBody><![CDATA[param($sourceId, $managedEntityId, $computerName)
$api = New-Object -ComObject 'MOM.ScriptAPI'
$discoveryData = $api.CreateDiscoveryData(0, $sourceId, $managedEntityId)

#foreach($subFolder in $subFolders)
#{
#    $subFolder.FullName
#}

for ($i=1; $i -le 2; $i++)
{
    $instance = $discoveryData.CreateClassInstance("$MPElement[Name='Pure.FlashArrays.Arrays']$")
    $instance.AddProperty("$MPElement[Name='Windows!Microsoft.Windows.Computer']/PrincipalName$", $computerName)
    $instance.AddProperty("$MPElement[Name='Pure.FlashArrays.Arrays']/Controllers$", "Controller " + $i)
    $instance.AddProperty("$MPElement[Name='Pure.FlashArrays.Arrays']/Hosts$", "Host " + $i)
    $instance.AddProperty("$MPElement[Name='Pure.FlashArrays.Arrays']/Volumes$", "Volume " + $i)

    $discoveryData.AddInstance($instance)
}

$discoveryData]]></ScriptBody>
          <Parameters>
            <Parameter>
              <Name>sourceId</Name>
              <Value>$MPElement$</Value>
            </Parameter>
            <Parameter>
              <Name>managedEntityId</Name>
              <Value>$Target/Id$</Value>
            </Parameter>
            <Parameter>
              <Name>computerName</Name>
              <Value>$Target/Host/Property[Type="Windows!Microsoft.Windows.Computer"]/PrincipalName$</Value>
            </Parameter>
          </Parameters>
          <TimeoutSeconds>300</TimeoutSeconds>
        </DataSource>
      </Discovery>
    </Discoveries>
    <Monitors>
      <UnitMonitor ID="PureStorage.FlashArrays.Monitor.ArraysComponents.ControllerNormal" Accessibility="Public" Enabled="true" Target="Pure.FlashArrays.ArraysComponents" ParentMonitorID="Health!System.Health.AvailabilityState" Remotable="true" Priority="Normal" TypeID="Windows!Microsoft.Windows.CheckNTServiceStateMonitorType" ConfirmDelivery="false">
        <Category>AvailabilityHealth</Category>
        <AlertSettings AlertMessage="PureStorage.FlashArrays.Monitor.ArraysComponents.ControllerNormal.AlertMessage">
          <AlertOnState>Error</AlertOnState>
          <AutoResolve>true</AutoResolve>
          <AlertPriority>Normal</AlertPriority>
          <AlertSeverity>MatchMonitorHealth</AlertSeverity>
        </AlertSettings>
        <OperationalStates>
          <OperationalState ID="Running" MonitorTypeStateID="Running" HealthState="Success" />
          <OperationalState ID="NotRunning" MonitorTypeStateID="NotRunning" HealthState="Error" />
        </OperationalStates>
        <Configuration>
          <ComputerName>scom-xin</ComputerName>
          <ServiceName>Powershell scipt monitoring</ServiceName>
          <CheckStartupType>false</CheckStartupType>
        </Configuration>
      </UnitMonitor>
      <UnitMonitor ID="PureStorage.FlashArrays.Monitor.PowerShell" Accessibility="Public" Enabled="true" Target="Pure.FlashArrays.Arrays" ParentMonitorID="Health!System.Health.AvailabilityState" Remotable="true" Priority="Normal" TypeID="Pure.FlashArrays.Monitor.AccessArrays" ConfirmDelivery="false">
        <Category>AvailabilityHealth</Category>
        <OperationalStates>
          <OperationalState ID="Success" MonitorTypeStateID="Success" HealthState="Success" />
          <OperationalState ID="Failure" MonitorTypeStateID="Failure" HealthState="Error" />
        </OperationalStates>
        <Configuration>
          <IntervalSeconds>900</IntervalSeconds>
          <SyncTime>240</SyncTime>
          <TimeoutSeconds>300</TimeoutSeconds>
        </Configuration>
      </UnitMonitor>
    </Monitors>
  </Monitoring>
  <Presentation>
    <Views>
      <View ID="PureStorage.FlashArrays.View.State.Arrays" Accessibility="Internal" Target="Pure.FlashArrays.Arrays" TypeID="SC!Microsoft.SystemCenter.StateViewType" Visible="true">
        <Category>Operations</Category>
      </View>
      <View ID="PureStorage.FlashArrays.View.Alert.Arrays" Accessibility="Internal" Target="Pure.FlashArrays.Arrays" TypeID="SC!Microsoft.SystemCenter.AlertViewType" Visible="true">
        <Category>Operations</Category>
      </View>
    </Views>
    <Folders>
      <Folder ID="PureStorage.FlashArrays.Folder" Accessibility="Public" ParentFolder="SC!Microsoft.SystemCenter.Monitoring.ViewFolder.Root" />
    </Folders>
    <FolderItems>
      <FolderItem ElementID="PureStorage.FlashArrays.View.State.Arrays" Folder="PureStorage.FlashArrays.Folder" ID="PureStorage.FlashArrays.View.State.Arrays.FolderItem" />
      <FolderItem ElementID="PureStorage.FlashArrays.View.Alert.Arrays" Folder="PureStorage.FlashArrays.Folder" ID="PureStorage.FlashArrays.View.Alert.Arrays.FolderItem" />
    </FolderItems>
    <StringResources>
      <StringResource ID="Pure.FlashArrays.StringResources.AccessArrays" />
      <StringResource ID="PureStorage.FlashArrays.Monitor.ArraysComponents.ControllerNormal.AlertMessage" />
    </StringResources>
  </Presentation>
  <LanguagePacks>
    <LanguagePack ID="ENU" IsDefault="true">
      <DisplayStrings>
        <DisplayString ElementID="Pure.FlashArrays.StringResources.AccessArrays">
          <Name>Volumes</Name>
          <Description>$Data/Context/Value$</Description>
        </DisplayString>
        <DisplayString ElementID="PureStorage.FlashArrays.Monitor.ArraysComponents.ControllerNormal">
          <Name>Arrays Components Normal</Name>
          <Description>Description for the new unit monitor.</Description>
        </DisplayString>
        <DisplayString ElementID="PureStorage.FlashArrays.Monitor.ArraysComponents.ControllerNormal.AlertMessage">
          <Name>Controller is not running</Name>
          <Description>The controller has some problem and is no longer running.</Description>
        </DisplayString>
        <DisplayString ElementID="PureStorage.FlashArrays.Monitor.ArraysComponents.ControllerNormal" SubElementID="Running">
          <Name>Running</Name>
          <Description>Running</Description>
        </DisplayString>
        <DisplayString ElementID="PureStorage.FlashArrays.Monitor.ArraysComponents.ControllerNormal" SubElementID="NotRunning">
          <Name>NotRunning</Name>
          <Description>NotRunning</Description>
        </DisplayString>
        <DisplayString ElementID="PureStorage.FlashArrays.Monitor.PowerShell">
          <Name>Monitor for PowerShell Script</Name>
          <Description>Description for the new unit monitor.</Description>
        </DisplayString>
        <DisplayString ElementID="PureStorage.FlashArrays.Monitor.PowerShell" SubElementID="Success">
          <Name>Success</Name>
          <Description>Success</Description>
        </DisplayString>
        <DisplayString ElementID="PureStorage.FlashArrays.Monitor.PowerShell" SubElementID="Failure">
          <Name>Failure</Name>
          <Description>Failure</Description>
        </DisplayString>
        <DisplayString ElementID="PureStorage.FlashArrays.Folder">
          <Name>Pure Storage FlashArrays</Name>
          <Description></Description>
        </DisplayString>
        <DisplayString ElementID="PureStorage.FlashArrays.View.State.Arrays">
          <Name>Arrays</Name>
          <Description>Description for the new view</Description>
        </DisplayString>
        <DisplayString ElementID="PureStorage.FlashArrays.View.Alert.Arrays">
          <Name>Active Alerts</Name>
          <Description>Description for the new view</Description>
        </DisplayString>
        <DisplayString ElementID="PureStorage.FlashArrays">
          <Name>Pure Storage FlashArrays</Name>
        </DisplayString>
        <DisplayString ElementID="Pure.FlashArrays.ComputerRole.ArraysBase">
          <Name>FlashArrays Computer Role ArrayBase Class</Name>
          <Description></Description>
        </DisplayString>
        <DisplayString ElementID="Pure.FlashArrays.ComputerRole.ArraysBase" SubElementID="Version">
          <Name>Version</Name>
          <Description></Description>
        </DisplayString>
        <DisplayString ElementID="Pure.FlashArrays.Arrays">
          <Name>Pure Storage FlashArrays Arrays</Name>
          <Description></Description>
        </DisplayString>
        <DisplayString ElementID="Pure.FlashArrays.ArraysComponents">
          <Name>Pure Storage FlashArrays Components</Name>
          <Description></Description>
        </DisplayString>
        <DisplayString ElementID="Pure.FlashArrays.ArraysHostComponents">
          <Name>Pure Arrays Host Components</Name>
          <Description></Description>
        </DisplayString>
        <DisplayString ElementID="Pure.FlashArrays.InstanceGroups">
          <Name>Pure FlashArrays Instance Groups</Name>
          <Description></Description>
        </DisplayString>
        <DisplayString ElementID="Pure.FlashArrays.ComputerGroups">
          <Name>Pure FlashArrays Computer Groups</Name>
          <Description></Description>
        </DisplayString>
        <DisplayString ElementID="Pure.FlashArrays.HealthRollup">
          <Name>Pure FlashArrays Health Roll up</Name>
          <Description></Description>
        </DisplayString>
        <DisplayString ElementID="Pure.FlashArrays.HealthRollupContainsArrays">
          <Name>Pure FlashArrays Health Rollup Contains Arrays</Name>
          <Description></Description>
        </DisplayString>
        <DisplayString ElementID="PureStorage.FlashArrays.Discovery.Controllers.PowerShell">
          <Name>Discovery Controllers (PowerShell)</Name>
          <Description>Description for the new discovery.</Description>
        </DisplayString>
      </DisplayStrings>
      <KnowledgeArticles></KnowledgeArticles>
    </LanguagePack>
  </LanguagePacks>
</ManagementPack>